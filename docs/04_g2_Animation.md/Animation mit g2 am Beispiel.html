<!doctype html>
<html lang="de">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, minimum-scale=1,user-scalable=no">
<meta name="description" content="Zeichnen im Webbrowser">

<meta name="date" content="Wed Jan 01 2020 00:00:00 GMT+0100 (Central European Standard Time)">
<meta name="keywords" content="Web,Animation,Grundlagen,JavaScript,Programmierung,g2,Canvas,Pfade">
<title>Animation mit g2</title>
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/highlight.js@9.18.1/styles/tomorrow-night-bright.min.css">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex/dist/katex.min.css">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/markdown-it-texmath/css/texmath.css">
<link rel="stylesheet" href="../theme/style.css">
</head>
<body id="top">
<main>
  <nav>
<p><a href="../index.html"><img src="../img/cover.png"></img></a></p>
<h2 id="inhaltsverzeichnis">Inhaltsverzeichnis</h2>
<ol start="1">
    <li><details><summary markdown="span">Mechanismentechnik Wiederholung</summary>
        <ol>
        <li><a href="../01_Mechanismentechnik_Wiederholung.md/Getriebekinematik.html">Getriebekinematik</a></li> 
        <li><a href="../01_Mechanismentechnik_Wiederholung.md/Lageanalyse des Viergelenks.html">Lageanalyse des Viergelenks</a></li>
        <li><a href="../01_Mechanismentechnik_Wiederholung.md/Übertragungsgleichung.html">Übertragungsgleichung und Übertragungsfunktion</a></li>
        <li><a href="../01_Mechanismentechnik_Wiederholung.md/Koppelkurven.html">Koppelkurven</a></li>
        <li><a href="../01_Mechanismentechnik_Wiederholung.md/Geschwindigkeit.html">Geschwindigkeit</a></li>
        <li><a href="../01_Mechanismentechnik_Wiederholung.md/Beschleunigung.html">Beschleunigung</a></li>
        <li><a href="../01_Mechanismentechnik_Wiederholung.md/Relativbewegung.html">Relativbewegung</a></li>
        <li><a href="../01_Mechanismentechnik_Wiederholung.md/Pole der ebenen Bewegung.html">Pole der ebenen Bewegung</a></li> 
        </ol>
    </details></li>
</ol>
<ol start="2">
    <li><details><summary markdown="span">Webtechnologien</summary>
    <ol>
        <li><a href="../02_Webtechnologie.md/Grundlagen.html">Grundlagen</a></li>
        <li><a href="../02_Webtechnologie.md/Uebungen.html">Übungen</a></li> 
    </ol>
    </details></li>
</ol>
<ol start="3">
    <li><details><summary markdown="span">Grafik mit der Bibliotek g2</summary>
    <ol>
        <li><a href="../03_Grafik_mit_der_Bibliothek_g2.md/Grafik im Webbrowser.html">Grafik im Webbrowser</a></li>
        <li><a href="../03_Grafik_mit_der_Bibliothek_g2.md/g2 Methode.html">Methoden der g2 Bibliothek</a></li>
        <li><a href="../03_Grafik_mit_der_Bibliothek_g2.md/g2ExtErweiterung.html">Erweiterung g2.ext</a></li>
        <li><a href="../03_Grafik_mit_der_Bibliothek_g2.md/g2mecErweiterung.html">Erweiterung g2.mec</a></li>
        <li><a href="../03_Grafik_mit_der_Bibliothek_g2.md/g2 ChartErweiterung.html">Erweiterung g2.chart</a></li>
        <li><a href="../03_Grafik_mit_der_Bibliothek_g2.md/Übungen.html">Übungen</a></li>
    </ol>
    </details></li>
</ol>
<ol start="4">
    <li><details><summary markdown="span">g2 Animation</summary>
    <ol>
        <li><a href="../04_g2_Animation.md/Animation mit g2 am Beispiel.html">Animation mit g2 am Beispiel einer Kurbel</a></li>
        <li><a href="../04_g2_Animation.md/Übung-Federschwinge.html">Übung - Federschwinge</a></li>
        <li><a href="../04_g2_Animation.md/Übung-Rad.html">Übung - Rad</a></li>
        <li><a href="../04_g2_Animation.md/Übung-Pendelrolle.html">Übung - Pendelrolle</a></li>
    </ol>
    </details></li>
</ol>
<ol start="5">
    <li><details><summary markdown="span">g2 Interaktive Elemente</summary>
    <ol>
        <li><a href="../05_g2_Interaktive Elemente.md/Button.html">Button</a></li>
        <li><a href="../05_g2_Interaktive Elemente.md/Dropdown Menü.html">Dropdown Menü</a></li>
        <li><a href="../05_g2_Interaktive Elemente.md/Checkbox.html">Checkbox</a></li>
        <li><a href="../05_g2_Interaktive Elemente.md/Slider 1-2.html">Slider 1/2</a></li>
        <li><a href="../05_g2_Interaktive Elemente.md/Slider 2-2.html">Slider 2/2</a></li>
        <li><a href="../05_g2_Interaktive Elemente.md/GUI Bibliotheken.html">GUI Bibliotheken</a></li>
    </ol>
    </details></li>
</ol>
<ol start="6">
    <li><details><summary markdown="span">Die 5 Grundfälle der ebenen Vektoralgebra</summary>
    <ol>
        <li><a href="../06_Die_5_Grundfaelle_der_ebenen_Vektoralgebra.md/Grundfall I.html">Grundfall I</a></li>
        <li><a href="../06_Die_5_Grundfaelle_der_ebenen_Vektoralgebra.md/Grundfall II & III.html">Grundfall II & III</a></li>
        <li><a href="../06_Die_5_Grundfaelle_der_ebenen_Vektoralgebra.md/Grundfall IV.html">Grundfall IV</a></li>
        <li><a href="../06_Die_5_Grundfaelle_der_ebenen_Vektoralgebra.md/Grundfall V.html">Grundfall V</a></li> 
    </ol>
    </details></li>
</ol>
</nav>

<article>

<header>
<h1>Animation mit g2</h1>



<h5>Oktober 2020</h5>
<h5><b>Keywords:</b> Web, Animation, Grundlagen, JavaScript, Programmierung, g2, Canvas, Pfade</h5>
</header>
<h2 id="41-animation-mit-g2-am-beispiel-einer-kurbel">4.1 Animation mit g2 am Beispiel einer Kurbel</h2>
<p>Da nun bekannt ist wie man statische Grafikelemente mittels g2 in Canvas-2d darstellt, wollen wir uns nun mit der Animation dieser befassen. Das Grundprinzip hinter diesen Animationen ist, dass Koordinaten von Punkten, die sich bewegen sollen, zumindest implizit von einem Inkrement abhängen müssen. Man kann dieses Inkrement beliebig definieren, für physikalische/ingenieurmäßige Anwendungen bietet es sich jedoch meisten an, die Zeit als Inkrement zu benutzen.</p>
<p>JavaScript bietet mehrere Möglichkeiten, um die aktuelle Zeit abzurufen. Die gängigste Methode ist die Erstellung einer Instanz des Datum-Objekts. Dies wird mittels <code>let time = new Date();</code> erreicht. Das neue Objekt (<code>time</code>) repräsentiert den Moment seiner Erstellung und enthält zusätzlich eine Vielzahl von Methoden, die das Auslesen von Minuten, Sekunden etc. ermöglichen.<br>
Möchte man einer Variable die Zeit in Sekunden zuweisen, muss man zusätzlich auch noch die Millisekunden abrufen, da man sonst lediglich eine ganze Zahl zwischen 0 und 60 zurückbekommt. Ohne die Millisekunden würde sich das Bild also nur ein Mal pro Sekunde neu aufbauen, was in einer stotternden Animation resultieren würde.<br>
Mittels <code>var t = time.getSeconds() + time.getMillieconds()/1000</code>  wurde <code>t</code> hier auf die Systemzeit zur Erstellung von <code>time</code> und in der Einheit Sekunden initialisiert.</p>
<p>Um eine Animation als flüssig wahrzunehmen, werden mindestens 24fps (frames per second) benötigt. Da moderne Monitore allerdings eine Bildwiederholfrequenz von mindestens 60Hz haben, sollte man diese, zumindest annähernd, auch ausreizen.</p>
<p>Während sich das Problem der umständlichen Syntax durch den Aufruf der Methode <code>Date.now()</code>, welche die Zeit in Millisekunden ausgibt, beheben ließe, besteht die Abhängigkeit des Datum-Objekts von der Systemzeit jedoch weiterhin. Das ist insofern schlecht, als dass diese hin und wieder mit einem eingestellten Server synchronisiert wird und es dadurch zu Inkonsistenzen in der Zeit und somit zu Sprüngen in der Animation kommen kann. Auch aus diesem Grund wurde in JavaScript das performance-Objekt eingeführt. Dieses wird jedes Mal beim Laden der Seite initialisiert, startet beim Wert 0 und wächst mit einer konstanten Rate. Der Code <code>var t = performance.now();</code> initialisiert eine Variable, welche die Zeit, die seit dem Laden der Seite vergangen ist, in Millisekunden mit einer Genauigkeit von fünf Mikrosekunden enthält. Auf dieser Basis wurde dann die Methode <code>requestAnimationFrame(callback)</code> eingeführt. Diese Methode übergibt automatisch einen Zeitstempel der auf <code>performance.now()</code> basiert als Parameter an die entsprechende Callback Funktion.</p>
<h3 id="411-einf%C3%BChrungsbeispiel---kurbel">4.1.1 Einführungsbeispiel - Kurbel</h3>
<p>Als Einführungsbeispiel wollen wir uns nun jedoch erst einmal die Animation mit einem beliebigen Inkrement anschauen. Dazu soll eine Kurbel animiert werden, die sich um ein Festlager mathematisch positiv im Kreis dreht. Das fertige Beispiel wird folgendermaßen aussehen:</p>
<iframe width=100% height=400 frameborder='no' src='https://goessner.github.io/webkinematik/Animation/Kurbel.html'></iframe>
<p>Es empfiehlt sich mit Vektoren in Polarkoordinatenform zu arbeiten, da wir <eq><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>φ</mi></mrow><annotation encoding="application/x-tex">\varphi</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.625em;vertical-align:-0.19444em;"></span><span class="mord mathnormal">φ</span></span></span></span></eq> inkrementieren wollen. Wenn wir den Ursprung in die Mitte des Canvas legen, benötigen wir also lediglich den Einheitsvektor <eq><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi mathvariant="bold-italic">e</mi><mi>φ</mi></msub><mo>=</mo><mrow><mo fence="true">(</mo><mstyle displaystyle="true" scriptlevel="0"><mfrac linethickness="0px"><mrow><mi>cos</mi><mo>⁡</mo><mi>φ</mi></mrow><mrow><mi>sin</mi><mo>⁡</mo><mi>φ</mi></mrow></mfrac></mstyle><mo fence="true">)</mo></mrow></mrow><annotation encoding="application/x-tex">\bm e_\varphi=\dbinom{\cos\varphi}{\sin\varphi}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.730548em;vertical-align:-0.286108em;"></span><span class="mord"><span class="mord"><span class="mord boldsymbol">e</span></span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.15139200000000003em;"><span style="top:-2.5500000000000003em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">φ</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.286108em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:2.40003em;vertical-align:-0.95003em;"></span><span class="mord"><span class="mopen delimcenter" style="top:0em;"><span class="delimsizing size3">(</span></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.10756em;"><span style="top:-2.314em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mop">sin</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord mathnormal">φ</span></span></span><span style="top:-3.6770000000000005em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mop">cos</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord mathnormal">φ</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.8804400000000001em;"><span></span></span></span></span></span><span class="mclose delimcenter" style="top:0em;"><span class="delimsizing size3">)</span></span></span></span></span></span></eq> sowie die Länge <eq><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>l</mi></mrow><annotation encoding="application/x-tex">l</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.69444em;vertical-align:0em;"></span><span class="mord mathnormal" style="margin-right:0.01968em;">l</span></span></span></span></eq> der Kurbel, um diesen zu skalieren.</p>
<p>Wir beginnen nun mit einem HTML-Template, in dem ein 300x300px großes Canvas-Element definiert wird und binden die minimierten g2 und g2.mec Bibliotheken über das bekannte CDN ein.</p>
<pre><code class="code-line language-HTML"><div><span class="hljs-meta">&lt;!doctype html&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">html</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">head</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">charset</span>=<span class="hljs-string">'utf-8'</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">title</span>&gt;</span>Kurbel<span class="hljs-tag">&lt;/<span class="hljs-name">title</span>&gt;</span>      
<span class="hljs-tag">&lt;/<span class="hljs-name">head</span>&gt;</span>
 
<span class="hljs-tag">&lt;<span class="hljs-name">body</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">h2</span>&gt;</span>Kurbel<span class="hljs-tag">&lt;/<span class="hljs-name">h2</span>&gt;</span>             
    <span class="hljs-tag">&lt;<span class="hljs-name">canvas</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"c"</span> <span class="hljs-attr">width</span>=<span class="hljs-string">"300"</span> <span class="hljs-attr">height</span>=<span class="hljs-string">"300"</span> <span class="hljs-attr">style</span>=<span class="hljs-string">"border-width:1px;border-style:solid"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">canvas</span>&gt;</span>
 
    <span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">src</span>=<span class="hljs-string">"https://gitcdn.xyz/repo/goessner/g2/master/src/g2.js"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">src</span>=<span class="hljs-string">"https://gitcdn.xyz/repo/goessner/g2-ext/master/g2.ext.min.js"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span>

    <span class="hljs-tag">&lt;<span class="hljs-name">script</span>&gt;</span>
 
    <span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span>
 
<span class="hljs-tag">&lt;/<span class="hljs-name">body</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">html</span>&gt;</span>
</div></code></pre>
<h3 id="412-variablen">4.1.2 Variablen</h3>
<p>Im zu erstellenden Script initialisieren wir zuerst die globalen Variablen. Wir legen Abkürzungen für das Canvas sowie seinen 2d-Context an <code>let cnv = document.getElementById('c'), ctx = cnv.getContext('2d')</code>, und weisen einer Variable den Wert von <eq><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>π</mi></mrow><annotation encoding="application/x-tex">\pi</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.43056em;vertical-align:0em;"></span><span class="mord mathnormal" style="margin-right:0.03588em;">π</span></span></span></span></eq> zu, da sich dieser ja nicht ändert und so nur einmal die entsprechende Methode aufgerufen werden muss <code>pi = Math.PI</code>. Anschließend fügen wir noch eine Variable für die Länge der Kurbel hinzu <code>l = 100</code>, sowie die Laufvariable <code>phi</code>, die wir auf 0rad initialisieren <code>phi = 0</code>.</p>
<p>Das Script sollte bis hierhin folgendermaßen aussehen:</p>
<pre><code class="code-line language-JavaScript"><div><span class="hljs-keyword">let</span> cnv = <span class="hljs-built_in">document</span>.getElementById(<span class="hljs-string">'c'</span>),
    ctx = cnv.getContext(<span class="hljs-string">'2d'</span>),
    pi = <span class="hljs-built_in">Math</span>.PI,
    l = <span class="hljs-number">100</span>,  <span class="hljs-comment">// Laenge der Kurbel</span>
    phi = <span class="hljs-number">0</span>,  <span class="hljs-comment">// Laufvariable</span>
<span class="hljs-comment">// ...</span>
</div></code></pre>
<blockquote>
<h5 id="anmerkung">Anmerkung:</h5>
<p><code>let cnv = ... , ctx = ... , pi = ... , l = 100;</code> ist eine verkürzte Schreibweise der Deklaration in JavaScript, welche mit einem Semikolon (;) abgeschlossen werden muss. Die Schreibweise ist äquivalent zu</p>
<pre><code class="code-line language-JavaScript"><div><span class="hljs-keyword">let</span> cnv = ... ;
<span class="hljs-keyword">let</span> ctx = ... ;
<span class="hljs-keyword">let</span> pi = ... ;
</div></code></pre>
<p>.</p>
</blockquote>
<p>Um sich direkt einen guten Programmierstil anzugewöhnen, werden wir nun ein Objekt anlegen, das alle Parameter des dynamischen Mechanismus enthält, die sich pro Frame ändern bzw. aktualisiert werden müssen.</p>
<blockquote>
<p>Zur Erinnerung - In JavaScript legt man Objekte mittels der Literalschreibweise folgendermaßen an:</p>
<pre><code class="code-line language-JavaScript"><div><span class="hljs-keyword">let</span> obj = {
  <span class="hljs-attr">property_1</span>: Wert_1,  <span class="hljs-comment">// property_# kann ein Identifier...</span>
           <span class="hljs-number">2</span>: Wert_2,  <span class="hljs-comment">// oder vom Typ number...</span>
              <span class="hljs-comment">// ...,</span>
  <span class="hljs-string">"property n"</span>: Wert_n   <span class="hljs-comment">// oder ein string sein</span>
};
</div></code></pre>
</blockquote>
<p>Objekte können zudem auch &quot;Getter&quot; enthalten. Diese binden Funktionen an <em>properties</em>, die erst evaluiert werden, wenn man sie aufruft, dann aber jedes Mal. Getter erstellt man mittels folgender Syntax: <code>get property_name() { ...Funktionsbody/Objekt... };</code>.</p>
<p>Wir erstellen nun ein Objekt, das Getter für <eq><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi mathvariant="bold-italic">e</mi><mi>φ</mi></msub></mrow><annotation encoding="application/x-tex">\bm e_\varphi</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.730548em;vertical-align:-0.286108em;"></span><span class="mord"><span class="mord"><span class="mord boldsymbol">e</span></span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.15139200000000003em;"><span style="top:-2.5500000000000003em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">φ</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.286108em;"><span></span></span></span></span></span></span></span></span></span></eq> und den Punkt <eq><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>A</mi></mrow><annotation encoding="application/x-tex">A</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.68333em;vertical-align:0em;"></span><span class="mord mathnormal">A</span></span></span></span></eq> enthält. Da wir die Kurbellänge <eq><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>l</mi></mrow><annotation encoding="application/x-tex">l</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.69444em;vertical-align:0em;"></span><span class="mord mathnormal" style="margin-right:0.01968em;">l</span></span></span></span></eq> bereits global definiert haben, brauchen wir sie hier nicht einfügen:</p>
<pre><code class="code-line language-JavaScript"><div>mec = {
    <span class="hljs-keyword">get</span> ephi() { <span class="hljs-keyword">return</span> { <span class="hljs-attr">x</span>:<span class="hljs-built_in">Math</span>.cos(phi), <span class="hljs-attr">y</span>:<span class="hljs-built_in">Math</span>.sin(phi) }; },
    <span class="hljs-keyword">get</span> A() { <span class="hljs-keyword">return</span> { <span class="hljs-attr">x</span>:l*<span class="hljs-keyword">this</span>.ephi.x, <span class="hljs-attr">y</span>:l*<span class="hljs-keyword">this</span>.ephi.y }; }
    }
</div></code></pre>
<p>Diese Getter liefern uns nun jeweils ein Objekt mit den Eigenschaften x und y, das den x-/y-Koordinaten entspricht. Zu beachten ist noch, dass sich der Getter für <code>A</code> bei <code>ephi</code> bedient. Daher muss, um auf die Komponenten von <code>ephi</code> zuzugreifen, angegeben werden, wo sich <code>ephi</code> befindet. Gibt man kein Parent an, wird davon ausgegangen, dass <code>ephi</code> zum window-Objekt gehört. Da sein Parent aber <code>mec</code> ist, muss man <code>mec</code> oder aber <code>this</code> (hier = selbes Parent) angeben.</p>
<p><code>mec.A.x</code> liefert nun z.B. 100 wenn <code>phi = 0</code> und -100 wenn <code>phi = pi</code>.</p>
<p>Nun folgt eine Neuerung gegenüber dem statischen Zeichnen mit g2. Während sonst ein g2-Objekt angelegt wurde, das man anschließend in den Context gerendert hat, teilen wir unsere Animation nun in zwei g2-Objekte auf. Ein g2-Objekt (<code>Kurbel</code>), das dynamische Geometrie enthält und eines (<code>world</code>), in dem wir alles, was seine Position nicht ändert, einfügen. In dem world-Objekt referenzieren wir mittels der g2-Methode <code>.use</code> dann lediglich das dynamische Objekt. Durch diese Methode wird das statische Objekt nur ein Mal beim Laden der Seite aufgebaut und nicht jedes Mal erneut, wenn sich die Positionen der dynamischen Geometrien aktualisieren. So spart man, je nach Umfang von <code>world</code>, einiges an Rechenzeit und Performance.</p>
<p>Weiterhin wichtig bei Animationen sind die g2-Methoden <code>.clr()</code> und <code>.del()</code>. <code>.clr()</code> kommt an den Anfang des world-Objekts und leert das Canvas. .del() schreibt man an den Anfang des dynamischen Objekts. Diese Methode löscht die bisherigen Kommandos, sodass nicht mehrere Positionen gleichzeitig, sondern nur die Momentane, gerendert werden.</p>
<p>Wir erstellen nun also unsere zwei g2-Objekte, füllen aber zuerst nur <code>world</code> mit Befehlen.</p>
<p>Das Script sollte nun so aussehen:</p>
<pre><code class="code-line language-JavaScript"><div><span class="hljs-keyword">let</span> cnv = <span class="hljs-built_in">document</span>.getElementById(<span class="hljs-string">'c'</span>),
    ctx = cnv.getContext(<span class="hljs-string">'2d'</span>),
    pi = <span class="hljs-built_in">Math</span>.PI,
    l = <span class="hljs-number">100</span>,  <span class="hljs-comment">// Laenge der Kurbel</span>
    phi = <span class="hljs-number">0</span>, <span class="hljs-comment">// Laufvariable</span>
    mec = {
        <span class="hljs-keyword">get</span> ephi() { <span class="hljs-keyword">return</span> {<span class="hljs-attr">x</span>:<span class="hljs-built_in">Math</span>.cos(phi), <span class="hljs-attr">y</span>:<span class="hljs-built_in">Math</span>.sin(phi)}; },
        <span class="hljs-keyword">get</span> A() { <span class="hljs-keyword">return</span> {<span class="hljs-attr">x</span>:l*<span class="hljs-keyword">this</span>.ephi.x, <span class="hljs-attr">y</span>:l*<span class="hljs-keyword">this</span>.ephi.y}; }
    },
    <span class="hljs-comment">// definiert Kurbel als g2() Objekt</span>
    kurbel = g2(),
    <span class="hljs-comment">// baut und initialisiert statische Umgebung</span>
    world = g2().clr()          <span class="hljs-comment">// leert das Canvas</span>
                .view({<span class="hljs-attr">cartesian</span>:<span class="hljs-literal">true</span>, <span class="hljs-attr">x</span>: <span class="hljs-number">150</span>, <span class="hljs-attr">y</span>: <span class="hljs-number">150</span>})    <span class="hljs-comment">// schaltet kartesische Koordinaten ein und verschiebt den Nullpunkt</span>
                .use({<span class="hljs-attr">grp</span>: Kurbel})    <span class="hljs-comment">// referenziert dynamisches Kurbel-Objekt</span>
                .use({<span class="hljs-attr">grp</span>: <span class="hljs-string">"nodfix"</span>})  <span class="hljs-comment">// statisches Festlager im Ursprung</span>
    ;
</div></code></pre>
<p>Da das kurbel-Objekt bislang leer ist, erstellen wir nun eine Funktion, die es mit Befehlen füllt. Diese Funktion nennen wir <code>position</code>, weil sie gleichzeitig auch die Position der Punkte des Mechanismus aktualisiert. In ihrem Körper füllen wir nun <code>kurbel</code> zuerst mit <code>.del()</code>,  mit einer Linie vom Ursprung nach <eq><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>A</mi></mrow><annotation encoding="application/x-tex">A</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.68333em;vertical-align:0em;"></span><span class="mord mathnormal">A</span></span></span></span></eq> und zuletzt mit einem Gelenkpunkt am Punkt <eq><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>A</mi></mrow><annotation encoding="application/x-tex">A</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.68333em;vertical-align:0em;"></span><span class="mord mathnormal">A</span></span></span></span></eq>.</p>
<p>Hier kommen uns nun die Getter zugute. Hätten wir diese nicht im mec-Objekt erstellt, müssten wir alle Positionsberechnungen in der position-Funktion vornehmen. Das würde zwar in diesem Fall kein Problem darstellen, wenn man jedoch komplexere Mechanismen wie zum Beispiel eine Kurbelschleife animieren möchte und dort Funktionen einbaut, die die Koppelkurve von Punkten berechnen, müsste man <code>phi</code> einzeln manipulieren. Hat man dann keine Getter zur Verfügung, muss man sämtliche geometrischen Berechnungen nochmal in der Koppelkurvenfunktion vornehmen.</p>
<p>Am Ende der position-Funktion inkrementieren wir <code>phi</code> dann um 1°. Da die Methoden des Math-Objekts allerdings in Radiant rechnen, sollte man somit <code>pi/180</code> als Inkrement angeben!</p>
<p>Die position-Funktion sollte folgendermaßen aussehen:</p>
<pre><code class="code-line language-JavaScript"><div><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">position</span>(<span class="hljs-params"></span>) </span>{
    <span class="hljs-comment">// baut dynamische Kurbel auf</span>
    kurbel.del()
          .lin({<span class="hljs-attr">x1</span>: <span class="hljs-number">0</span>, <span class="hljs-attr">y1</span>: <span class="hljs-number">0</span>, <span class="hljs-attr">x2</span>: mec.A.x, <span class="hljs-attr">y2</span>: mec.A.y, <span class="hljs-attr">lw</span>:<span class="hljs-number">3</span>})
          .use({<span class="hljs-attr">grp</span>: <span class="hljs-string">"nod"</span>, ...mec.A});
    <span class="hljs-comment">// inkrementiert phi</span>
    phi += pi/<span class="hljs-number">180</span>;
}
</div></code></pre>
<p>Nun erstellen wir noch eine Funktion, die alles in den Context rendert, und nennen sie passenderweise <code>render</code>.</p>
<p>Diese sieht so aus:</p>
<pre><code class="code-line language-JavaScript"><div><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">render</span>(<span class="hljs-params"></span>) </span>{
    <span class="hljs-comment">// aktualisiere Position</span>
    position();  
    <span class="hljs-comment">// rendert world in den Context</span>
    world.exe(ctx); 
    <span class="hljs-comment">// asynchroner callback von render()</span>
    requestAnimationFrame(render);
}
</div></code></pre>
<p>Zuerst wird <code>position()</code> aufgerufen, um die Position von <code>kurbel</code> zu aktualisieren. Anschließend wird <code>world</code>, welches ja das aktualisierte kurbel-Objekt enthält, in den Context gerendert. Zuletzt wird dann noch <code>requestAnimationFrame(render)</code> aufgerufen, um die Animation am Laufen zu halten.</p>
<p>Die Methode <code>requestAnimationFrame(callback)</code> wurde eigens für Animationen eingeführt. Es handelt sich hierbei nicht wie man fälschlicherweise annehmen könnte um eine Endrekursion, vielmehr wird unser JavaScript hierdurch asynchron. Bei einer Rekursion bleibt die vorherige Funktionsinstanz erhalten, während eine zweite, eine dritte etc. geöffnet wird. Hier wird <code>render()</code> sofort geschlossen und darauf gewartet, dass der Browser Zeit hat <code>render()</code> neu aufzurufen (Analogie: Bitte um Rückruf). Wann das passiert, hängt davon ab, wie viel gerade zu tun ist, garantiert jedoch vor dem nächsten Repaint der Seite. Bei einem 60Hz Monitor und ausreichender Performance des Systems also nach spätestens 16,67ms.</p>
<p>Mit diesem Wissen kann man sich nun ausrechnen, wie lange ein Umlauf bei unserem vorgegebenen Inkrement von 1° dauert.</p>
<section><eqn><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><mfrac><mrow><mn>360</mn><mi mathvariant="normal">°</mi></mrow><mrow><mfrac><mrow><mn>60</mn><mi>f</mi><mi>r</mi><mi>a</mi><mi>m</mi><mi>e</mi><mi>s</mi></mrow><mi>s</mi></mfrac><mo>⋅</mo><mfrac><mrow><mn>1</mn><mi mathvariant="normal">°</mi></mrow><mrow><mi>f</mi><mi>r</mi><mi>a</mi><mi>m</mi><mi>e</mi></mrow></mfrac></mrow></mfrac><mo>=</mo><mn>6</mn><mi>s</mi></mrow><annotation encoding="application/x-tex">\frac{360°}{\frac{60frames}{s}\cdot \frac{1°}{frame}} = 6s</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:2.6747639999999997em;vertical-align:-1.303324em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.37144em;"><span style="top:-2.177784em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.9322159999999999em;"><span style="top:-2.6550000000000002em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">s</span></span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.446108em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">6</span><span class="mord mtight">0</span><span class="mord mathnormal mtight" style="margin-right:0.10764em;">f</span><span class="mord mathnormal mtight" style="margin-right:0.02778em;">r</span><span class="mord mathnormal mtight">a</span><span class="mord mathnormal mtight">m</span><span class="mord mathnormal mtight">e</span><span class="mord mathnormal mtight">s</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.345em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">⋅</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.8801079999999999em;"><span style="top:-2.6550000000000002em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.10764em;">f</span><span class="mord mathnormal mtight" style="margin-right:0.02778em;">r</span><span class="mord mathnormal mtight">a</span><span class="mord mathnormal mtight">m</span><span class="mord mathnormal mtight">e</span></span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.394em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">1</span><span class="mord mtight">°</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.481108em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.677em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">3</span><span class="mord">6</span><span class="mord">0</span><span class="mord">°</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:1.303324em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.64444em;vertical-align:0em;"></span><span class="mord">6</span><span class="mord mathnormal">s</span></span></span></span></span></eqn></section><p>Zu guter Letzt muss noch einmal <code>render()</code> aufgerufen werden, um die Animation beim Laden der Seite anzustoßen.</p>
<h3 id="413-ergebnis">4.1.3 Ergebnis</h3>
<p>Das fertige HTML Dokument sollte nun so aussehen und kann im Browser betrachtet werden:</p>
<pre><code class="code-line language-HTML"><div><span class="hljs-meta">&lt;!doctype html&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">html</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">head</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">charset</span>=<span class="hljs-string">'utf-8'</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">title</span>&gt;</span>Kurbel<span class="hljs-tag">&lt;/<span class="hljs-name">title</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">head</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">body</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">h2</span>&gt;</span>Kurbel<span class="hljs-tag">&lt;/<span class="hljs-name">h2</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">canvas</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"c"</span> <span class="hljs-attr">width</span>=<span class="hljs-string">"300"</span> <span class="hljs-attr">height</span>=<span class="hljs-string">"300"</span> <span class="hljs-attr">style</span>=<span class="hljs-string">"border-width:1px;border-style:solid"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">canvas</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">src</span>=<span class="hljs-string">"https://gitcdn.xyz/repo/goessner/g2/master/src/g2.js"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span>
    
    <span class="hljs-tag">&lt;<span class="hljs-name">script</span>&gt;</span><span class="javascript">
        <span class="hljs-keyword">let</span> cnv = <span class="hljs-built_in">document</span>.getElementById(<span class="hljs-string">'c'</span>),
            ctx = cnv.getContext(<span class="hljs-string">'2d'</span>),
            pi = <span class="hljs-built_in">Math</span>.PI,
            l = <span class="hljs-number">100</span>,  <span class="hljs-comment">// Laenge der Kurbel</span>
            phi = <span class="hljs-number">0</span>, <span class="hljs-comment">// Laufvariable</span>
            mec = {
                <span class="hljs-keyword">get</span> ephi() { <span class="hljs-keyword">return</span> {<span class="hljs-attr">x</span>:<span class="hljs-built_in">Math</span>.cos(phi), <span class="hljs-attr">y</span>:<span class="hljs-built_in">Math</span>.sin(phi)}; },
                <span class="hljs-keyword">get</span> A() { <span class="hljs-keyword">return</span> {<span class="hljs-attr">x</span>:l*<span class="hljs-keyword">this</span>.ephi.x, <span class="hljs-attr">y</span>:l*<span class="hljs-keyword">this</span>.ephi.y}; }
            },
            Kurbel = g2(), <span class="hljs-comment">// definiert Kurbel als g2() Objekt</span>
            <span class="hljs-comment">// baut und initialisiert statische Umgebung</span>
            world = g2().clr()     <span class="hljs-comment">// leert das Canvas</span>
            .view({<span class="hljs-attr">cartesian</span>:<span class="hljs-literal">true</span>, <span class="hljs-attr">x</span>: <span class="hljs-number">150</span>, <span class="hljs-attr">y</span>: <span class="hljs-number">150</span>}) <span class="hljs-comment">// schaltet kart. KO-S. ein und verschiebt den Nullpunkt</span>
            .use({<span class="hljs-attr">grp</span>: Kurbel})    <span class="hljs-comment">// referenziert dynamisches Kurbel-Objekt</span>
            .use({<span class="hljs-attr">grp</span>: <span class="hljs-string">"nodfix"</span>})  <span class="hljs-comment">// statisches Festlager im Ursprung</span>
            ;
 
        <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">position</span>(<span class="hljs-params"></span>) </span>{ 
            <span class="hljs-comment">// baut dynamische Kurbel auf</span>
            kurbel.del()
            .lin({<span class="hljs-attr">x1</span>: <span class="hljs-number">0</span>, <span class="hljs-attr">y1</span>: <span class="hljs-number">0</span>, <span class="hljs-attr">x2</span>: mec.A.x, <span class="hljs-attr">y2</span>: mec.A.y, <span class="hljs-attr">lw</span>:<span class="hljs-number">3</span>})
            .use({<span class="hljs-attr">grp</span>: <span class="hljs-string">"nod"</span>, ...mec.A});
            <span class="hljs-comment">// inkrementiert phi</span>
            phi += pi/<span class="hljs-number">180</span>;
        }
 
        <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">render</span>(<span class="hljs-params"></span>) </span>{
            <span class="hljs-comment">// aktualisiere Position</span>
            position(); 
            <span class="hljs-comment">// rendert world in den Context</span>
            world.exe(ctx); 
            <span class="hljs-comment">// asynchroner callback von render()</span>
            requestAnimationFrame(render);
        }
 
        <span class="hljs-comment">// startet die Animation die mittels callbacks weiterlaeuft</span>
        render(); 
    </span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">body</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">html</span>&gt;</span>
</div></code></pre>
<h3 id="414-kurbel---zeitabh%C3%A4ngig">4.1.4 Kurbel - zeitabhängig</h3>
<p>Nun soll das selbe Beispiel mit einem zeitabhängigen Inkrement animiert werden. Dazu rufe man sich die Formeln für die gleichförmige Kreisbewegung ins Gedächtnis und erinnere sich an den Zusammenhang</p>
<section><eqn><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><mi>φ</mi><mo>=</mo><mi>ω</mi><mo>⋅</mo><mi>t</mi><mspace width="2em"/><mi>m</mi><mi>i</mi><mi>t</mi><mspace width="2em"/><mi>ω</mi><mo>=</mo><mfrac><mrow><mn>2</mn><mi>π</mi></mrow><mi>T</mi></mfrac></mrow><annotation encoding="application/x-tex">\varphi = \omega\cdot t\qquad mit\qquad \omega = \frac{2\pi}{T}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.625em;vertical-align:-0.19444em;"></span><span class="mord mathnormal">φ</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.44445em;vertical-align:0em;"></span><span class="mord mathnormal" style="margin-right:0.03588em;">ω</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">⋅</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:0.65952em;vertical-align:0em;"></span><span class="mord mathnormal">t</span><span class="mspace" style="margin-right:2em;"></span><span class="mord mathnormal">m</span><span class="mord mathnormal">i</span><span class="mord mathnormal">t</span><span class="mspace" style="margin-right:2em;"></span><span class="mord mathnormal" style="margin-right:0.03588em;">ω</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:2.00744em;vertical-align:-0.686em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.32144em;"><span style="top:-2.314em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.13889em;">T</span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.677em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">2</span><span class="mord mathnormal" style="margin-right:0.03588em;">π</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.686em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span></span></span></span></span></eqn></section><p>Da wir weiter oben ausgerechnet haben, dass ein voller Umlauf bei 60Hz 6 Sekunden dauert, entspricht dies hier der Periodendauer <eq><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>T</mi></mrow><annotation encoding="application/x-tex">T</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.68333em;vertical-align:0em;"></span><span class="mord mathnormal" style="margin-right:0.13889em;">T</span></span></span></span></eq>.</p>
<p>Wir fügen nun <code>T = 6</code> und <code>omega = 2*pi/T</code> zu den globalen Variablen in unserem Script hinzu. Außerdem erstellen wir noch eine Variable <code>t0 = false</code>, die die Differenz der Animationszeit von der globalen Zeit enthalten wird. Aufgrund der dynamischen Typisierung in JavaScript ist es kein Problem eine boolean Variable später zum Typ <code>number</code> zu ändern.</p>
<p>Im obigen Beispiel haben wir am Ende der Funktion <code>position()</code> <eq><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>φ</mi></mrow><annotation encoding="application/x-tex">\varphi</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.625em;vertical-align:-0.19444em;"></span><span class="mord mathnormal">φ</span></span></span></span></eq> inkrementiert. Diese Zeile (ehemals 48) muss entfernt werden und stattdessen evaluieren wir <code>phi</code>, das ja nun von <code>t</code> abhängt, neu, bevor das dynamische g2_objekt aufgebaut wird: <code>phi = omega*t;</code></p>
<p>Da die Zeit <code>t</code> als Parameter aus der render-Funktion nach <code>position()</code> übergeben werden soll, fügen wir den Klammern des Identifiers ein <code>t</code> hinzu, also <code>position(t)</code>.</p>
<p>Damit die Zeit in <code>position()</code> auch ankommt muss die render-Funktion noch geändert werden. Auch diese bekommt eine Zeit übergeben und so fügen wir auch ihrem Identifier einen Parameter hinzu, <code>render(time)</code>.<br>
Wir erinnern uns, dass wir eine Variable <code>t0 = false</code> initialisiert haben. Dieser möchten wir nun die Animationsstartzeit zuweisen, da die Animationszeit von der globalen Zeit, z.B. durch einen Startbutton, abweichen kann. Diese Zuweisung soll aber nur geschehen, wenn die Animationsstartzeit noch nicht gesetzt wurde, also fügen wir <code>if (!t0) t0 = time;</code> hinzu.<br>
Den gewohnten Aufruf von <code>position()</code> ergänzen wir nun um die Übergabe eines Parameters, der der aktuellen Animationszeit entspricht. Diese ist die Differenz der momentanen Zeit und der Animationsstartzeit umgerechnet in Sekunden.</p>
<p>Den erstmaligen Aufruf der render-Funktion (im Beispiel mit beliebigem Inkrement in Zeile 62) ersetzen wir hier nun durch <code>requestAnimationFrame(render)</code>;.<br>
Wie bereits in der Einleitung dieses Kapitels erwähnt, übergibt <code>requestAnimationFrame()</code> seinem Callback (hier <code>render(time)</code>) einen Zeitstempel in Millisekunden als Parameter. Diesen nehmen wir in der render-Funktion mit <code>time</code> an, berechnen die Differenz zur Startzeit und übergeben schließlich die aktuelle Animationszeit für etwaige Berechnungen.</p>
<h3 id="415-ergebnis-zeitabh%C3%A4ngige-kurbel">4.1.5 Ergebnis: Zeitabhängige Kurbel</h3>
<p>Der geänderte Quelltext sollte nun folgendermaßen aussehen und unspektakulärer Weise bei der Betrachtung im Browser exakt das selbe Verhalten zeigen wie der alte:</p>
<pre><code class="code-line language-HTML"><div><span class="hljs-meta">&lt;!doctype html&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">html</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">head</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">charset</span>=<span class="hljs-string">'utf-8'</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">title</span>&gt;</span>Kurbel<span class="hljs-tag">&lt;/<span class="hljs-name">title</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">head</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">body</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">h2</span>&gt;</span>Kurbel<span class="hljs-tag">&lt;/<span class="hljs-name">h2</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">canvas</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"c"</span> <span class="hljs-attr">width</span>=<span class="hljs-string">"300"</span> <span class="hljs-attr">height</span>=<span class="hljs-string">"300"</span> <span class="hljs-attr">style</span>=<span class="hljs-string">"border-width:1px;border-style:solid"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">canvas</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">src</span>=<span class="hljs-string">"https://gitcdn.xyz/repo/goessner/g2/master/src/g2.js"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span>
    
    <span class="hljs-tag">&lt;<span class="hljs-name">script</span>&gt;</span><span class="javascript">
        <span class="hljs-keyword">let</span> cnv = <span class="hljs-built_in">document</span>.getElementById(<span class="hljs-string">'c'</span>),
            ctx = cnv.getContext(<span class="hljs-string">'2d'</span>),
            pi = <span class="hljs-built_in">Math</span>.PI,
            l = <span class="hljs-number">100</span>,  <span class="hljs-comment">// Laenge der Kurbel</span>
            phi = <span class="hljs-number">0</span>,  <span class="hljs-comment">// Laufvariable</span>
            T = <span class="hljs-number">6</span>,  <span class="hljs-comment">// Periodendauer</span>
            omega = <span class="hljs-number">2</span>*pi/T,  <span class="hljs-comment">// Winkelgeschwindigkeit</span>
            t0 = <span class="hljs-literal">false</span>,  <span class="hljs-comment">// Startzeit</span>
            mec = {
                <span class="hljs-keyword">get</span> ephi() { <span class="hljs-keyword">return</span> {<span class="hljs-attr">x</span>:<span class="hljs-built_in">Math</span>.cos(phi), <span class="hljs-attr">y</span>:<span class="hljs-built_in">Math</span>.sin(phi)}; },
                <span class="hljs-keyword">get</span> A() { <span class="hljs-keyword">return</span> {<span class="hljs-attr">x</span>:l*<span class="hljs-keyword">this</span>.ephi.x, <span class="hljs-attr">y</span>:l*<span class="hljs-keyword">this</span>.ephi.y}; }
            },
            <span class="hljs-comment">// definiert Kurbel als g2() Objekt</span>
            kurbel = g2(),
            <span class="hljs-comment">// baut und initialisiert statische Umgebung</span>
            world = g2().clr()     <span class="hljs-comment">// leert das Canvas</span>
            .view({<span class="hljs-attr">cartesian</span>:<span class="hljs-literal">true</span>, <span class="hljs-attr">x</span>: <span class="hljs-number">150</span>, <span class="hljs-attr">y</span>: <span class="hljs-number">150</span>})    <span class="hljs-comment">// schaltet kart. KO-S. ein und verschiebt den Nullpunkt</span>
            .use({<span class="hljs-attr">grp</span>: Kurbel})    <span class="hljs-comment">// referenziert dynamisches Kurbel-Objekt</span>
            .use({<span class="hljs-attr">grp</span>: <span class="hljs-string">"nodfix"</span>})  <span class="hljs-comment">// statisches Festlager im Ursprung</span>
        ;
 
        <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">position</span>(<span class="hljs-params">t</span>) </span>{
            <span class="hljs-comment">// aktualisiet phi</span>
            phi = omega*t;
            <span class="hljs-comment">// baut dynamische Kurbel auf</span>
            Kurbel.del()
            .lin({<span class="hljs-attr">x1</span>: <span class="hljs-number">0</span>, <span class="hljs-attr">y1</span>: <span class="hljs-number">0</span>, <span class="hljs-attr">x2</span>: mec.A.x, <span class="hljs-attr">y2</span>: mec.A.y, <span class="hljs-attr">lw</span>:<span class="hljs-number">3</span>})
            .use({<span class="hljs-attr">grp</span>: <span class="hljs-string">"nod"</span>, ...mec.A});
        }
 
        <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">render</span>(<span class="hljs-params">time</span>) </span>{
            <span class="hljs-comment">// initialisiert Startzeit falls das noch nicht passiert ist</span>
            <span class="hljs-keyword">if</span> (!t0) t0 = time;
            <span class="hljs-comment">// aktualisiere Position mit Uebernahme der mom. Animationszeit</span>
            position((time-t0)/<span class="hljs-number">1000</span>);
            <span class="hljs-comment">// rendert world in den Context</span>
            world.exe(ctx);
            <span class="hljs-comment">// asynchroner callback von render()</span>
            requestAnimationFrame(render);
        }
 
        <span class="hljs-comment">// startet die Animation die mittels callbacks weiterlaeuft</span>
        requestAnimationFrame(render);
    </span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">body</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">html</span>&gt;</span>
</div></code></pre>

</article>
</main>
<script src="../js/g2.html.js"></script>
<script src="../js/mec2.html.js"></script>
</body>
</html>